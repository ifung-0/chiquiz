<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­å››ç´šé–±è®€èƒ½åŠ› æŒ‡å®šç¯‡ç« æ¸©ç¿’æ¸¬é©— (é›¢ç·šç‰ˆ)</title>
    <style>
        :root {
            --primary: #4a6fa5;
            --primary-dark: #34517b;
            --success: #28a745;
            --danger: #dc3545;
            --light: #f8f9fa;
            --dark: #343a40;
            --card-bg: #ffffff;
            --chat-user: #e3f2fd;
            --chat-ai: #f1f0f0;
        }

        body {
            font-family: "Noto Sans TC", "Microsoft JhengHei", "PingFang TC", sans-serif;
            background-color: #f0f2f5;
            color: var(--dark);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            background-color: var(--primary);
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }

        h1 { margin: 0; font-size: 1.5rem; }
        h2 { font-size: 1.2rem; font-weight: normal; opacity: 0.9; margin-top: 0.5rem; }

        main {
            flex: 1;
            padding: 1rem;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.2s;
            display: inline-block;
            margin: 5px;
            width: 100%;
            max-width: 300px;
        }

        .btn:hover { background-color: var(--primary-dark); }
        .btn:active { transform: translateY(1px); }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }
        .btn-outline:hover { background: #f0f4f8; }
        
        /* Chat Choice Buttons */
        .chat-category-title {
            font-size: 0.85rem;
            color: #888;
            margin: 10px 0 5px;
            padding-left: 5px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .btn-choice {
            background-color: white;
            color: var(--primary);
            border: 1px solid #d0d7de;
            text-align: left;
            margin: 4px 0;
            width: 100%;
            max-width: 100%;
            padding: 12px 15px;
            border-radius: 12px;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .btn-choice:hover {
            background-color: #e3f2fd;
            border-color: var(--primary);
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Menu Styles */
        #menu-screen { text-align: center; }
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .section-title {
            margin: 2rem 0 1rem;
            border-bottom: 2px solid #eee;
            padding-bottom: 0.5rem;
            color: #666;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* Quiz Styles */
        #quiz-screen { display: none; }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: #e9ecef;
            border-radius: 4px;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--primary);
            width: 0%;
            transition: width 0.3s ease;
        }

        .stats-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: #6c757d;
        }

        .question-box {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 2rem;
            color: var(--dark);
        }

        .highlight-word {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 2px;
            font-weight: bold;
            text-decoration: none;
        }

        .options-grid {
            display: grid;
            gap: 1rem;
        }

        .option-btn {
            background-color: white;
            border: 2px solid #dee2e6;
            color: var(--dark);
            text-align: left;
            padding: 15px;
            font-size: 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .option-btn:hover {
            border-color: var(--primary);
            background-color: #f8f9fa;
        }

        .option-btn.correct {
            background-color: #d4edda;
            border-color: var(--success);
            color: #155724;
        }

        .option-btn.incorrect {
            background-color: #f8d7da;
            border-color: var(--danger);
            color: #721c24;
        }

        /* Result Screen */
        #result-screen { display: none; text-align: center; }
        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 0 auto 2rem;
            font-size: 2.5rem;
            font-weight: bold;
        }
        .score-label { font-size: 1rem; font-weight: normal; opacity: 0.9; }

        /* Chat Screen */
        #chat-screen { display: none; height: calc(100vh - 140px); flex-direction: column; }
        #chat-selection { display: none; text-align: center; }
        
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 12px;
            border: 1px solid #eee;
            margin-bottom: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            scroll-behavior: smooth;
        }

        .chat-bubble {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 0.95rem;
            position: relative;
            line-height: 1.5;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .chat-bubble.user {
            align-self: flex-end;
            background-color: var(--chat-user);
            color: #0d47a1;
            border-bottom-right-radius: 4px;
        }

        .chat-bubble.ai {
            align-self: flex-start;
            background-color: var(--chat-ai);
            color: #333;
            border-bottom-left-radius: 4px;
        }
        
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
            background: var(--chat-ai);
            border-radius: 18px;
            border-bottom-left-radius: 4px;
            width: fit-content;
            align-self: flex-start;
            margin-bottom: 10px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #999;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .chat-controls {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            background: white;
            padding-top: 1rem;
            border-top: 1px solid #eee;
        }
        
        .chat-options-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
            text-align: center;
            font-weight: bold;
        }
        
        #chat-options-container {
            max-height: 200px;
            overflow-y: auto;
            padding-right: 5px;
        }

        /* Custom scrollbar for chat options */
        #chat-options-container::-webkit-scrollbar {
            width: 6px;
        }
        #chat-options-container::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        #chat-options-container::-webkit-scrollbar-thumb {
            background: #ccc; 
            border-radius: 3px;
        }

        .hidden { display: none !important; }

        @media (max-width: 600px) {
            .card { padding: 1.5rem; }
            .question-box { font-size: 1.1rem; }
            .btn { width: 100%; margin: 5px 0; }
        }
    </style>
</head>
<body>

<header>
    <h1>æŒ‡å®šç¯‡ç« æº«ç¿’æ¸¬é©—</h1>
    <h2>å¸«èªª Â· å²³é™½æ¨“è¨˜ Â· è©©ä¸‰é¦–</h2>
</header>

<main>
    <!-- MENU SCREEN -->
    <div id="menu-screen" class="card">
        <h3>è«‹é¸æ“‡æ¨¡å¼</h3>
        
        <div class="section-title">ğŸ“ æº«ç¿’æ¸¬é©—</div>
        <div class="menu-grid" style="margin-top: 1rem;">
            <button class="btn" onclick="startQuiz('all')">å…¨éƒ¨ç¯„åœ (ç¶œåˆ)</button>
            <button class="btn" onclick="startQuiz('shishuo')">éŸ“æ„ˆã€ˆå¸«èªªã€‰</button>
            <button class="btn" onclick="startQuiz('yueyang')">èŒƒä»²æ·¹ã€ˆå²³é™½æ¨“è¨˜ã€‰</button>
            <button class="btn" onclick="startQuiz('poems')">è©©ä¸‰é¦– (å­—è©+ä¸»æ—¨)</button>
        </div>

        <div class="section-title">ğŸ’¬ èˆ‡å¤äººå°è©± (é›¢ç·šç‰ˆ)</div>
        <div class="menu-grid" style="margin-top: 1rem;">
            <button class="btn btn-outline" onclick="showChatSelection()">é€²å…¥å°è©±æ¨¡å¼</button>
        </div>
    </div>

    <!-- QUIZ SCREEN -->
    <div id="quiz-screen" class="card">
        <div class="stats-bar">
            <span id="question-counter">é¡Œç›®: 1 / 10</span>
            <span id="score-counter">å¾—åˆ†: 0</span>
        </div>
        <div class="progress-bar">
            <div id="progress-fill" class="progress-fill"></div>
        </div>
        
        <div id="question-text" class="question-box">
            <!-- Question injected here -->
        </div>

        <div id="options-container" class="options-grid">
            <!-- Options injected here -->
        </div>

        <div id="feedback-area" style="margin-top: 1rem; text-align: center; min-height: 50px;">
            <!-- Feedback text -->
        </div>

        <div style="text-align: center; margin-top: 1rem;">
            <button id="next-btn" class="btn hidden" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ</button>
            <button id="finish-btn" class="btn hidden" onclick="showResults()">æŸ¥çœ‹çµæœ</button>
        </div>
    </div>

    <!-- CHAT SELECTION SCREEN -->
    <div id="chat-selection" class="card">
        <h3>é¸æ“‡å°è©±äººç‰©</h3>
        <p>è«‹é¸æ“‡ä¸€ä½å¤äººé€²è¡Œå°è©±ï¼š</p>
        <div class="menu-grid">
            <button class="btn" onclick="startChat('hanyu')">éŸ“æ„ˆ (å¸«èªª)</button>
            <button class="btn" onclick="startChat('fanzhongyan')">èŒƒä»²æ·¹ (å²³é™½æ¨“è¨˜)</button>
            <button class="btn" onclick="startChat('poets')">å”ä»£è©©äºº (è©©ä¸‰é¦–)</button>
            <button class="btn btn-outline" onclick="resetApp()">è¿”å›ä¸»ç›®éŒ„</button>
        </div>
    </div>

    <!-- CHAT SCREEN -->
    <div id="chat-screen" class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; border-bottom: 1px solid #eee; padding-bottom: 10px;">
            <div>
                <h3 id="chat-title" style="margin: 0; font-size: 1.1rem;">èˆ‡å¤äººå°è©±</h3>
                <span id="chat-subtitle" style="font-size: 0.8rem; color: #666;">åœ¨ç·šä¸­...</span>
            </div>
            <button class="btn btn-outline" style="padding: 5px 12px; font-size: 0.8rem; width: auto; margin:0;" onclick="exitChat()">é›¢é–‹</button>
        </div>
        
        <div id="chat-container" class="chat-container">
            <!-- Chat logs go here -->
        </div>

        <div class="chat-controls">
            <div class="chat-options-label">ğŸ’¡ é»æ“Šä¸‹æ–¹å•é¡Œæå•ï¼š</div>
            <div id="chat-options-container">
                <!-- Question buttons go here -->
            </div>
        </div>
    </div>

    <!-- RESULT SCREEN -->
    <div id="result-screen" class="card">
        <h3>æ¸¬é©—å®Œæˆ!</h3>
        <div class="score-circle">
            <span id="final-score">0%</span>
            <span class="score-label">æº–ç¢ºç‡</span>
        </div>
        <p id="result-message"></p>
        <button class="btn" onclick="resetApp()">è¿”å›ä¸»ç›®éŒ„</button>
    </div>
</main>

<script>
    // ================= DATA STORE =================
    // Helper for formatting
    const hl = (text) => `<span class="highlight-word">${text}</span>`;

    // EXTENDED Static Chat Data (Offline)
    // Updated with notes from user uploads (Notes.txt and Scanned PDF)
    const chatData = {
        hanyu: {
            name: "éŸ“æ„ˆ",
            intro: "å¾ä¹ƒéŸ“æ„ˆï¼Œå­—é€€ä¹‹ã€‚è¦‹æ™‚äººæ¥æ–¼å¾å¸«ï¼Œæ•…ä½œã€Šå¸«èªªã€‹ä»¥æ­£è¦–è½ã€‚ä½ æœ‰ä½•å›°æƒ‘ï¼Ÿ",
            categories: {
                "å¯«ä½œèƒŒæ™¯": [
                    { q: "ç‚ºä»€éº¼ä½ è¦å¯«ã€Šå¸«èªªã€‹ï¼Ÿ", a: "ç•¶æ™‚ç¤¾æœƒé¢¨æ°£æ•—å£ï¼Œå£«å¤§å¤«ä¹‹æ—æ¥æ–¼å¾å¸«ã€‚æˆ‘å¯«é€™ç¯‡æ–‡ç« é€çµ¦å¼Ÿå­æèŸ ï¼Œæ­£æ˜¯å› ç‚ºä»–ã€Œä¸æ‹˜æ–¼æ™‚ï¼Œå­¸æ–¼ä½™ã€ï¼Œæˆ‘æ¬²ä»¥æ­¤è«·åˆºæ™‚å¼Šï¼Œé¼“å‹µæ™‚äººæ‡‰æœ‰å¾å¸«è€Œå­¸çš„æ…‹åº¦ã€‚" },
                    { q: "ç•¶æ™‚çš„äººå°ã€Œå¾å¸«ã€æœ‰ä»€éº¼çœ‹æ³•ï¼Ÿ", a: "å”‰ï¼Œç•¶æ™‚çš„å£«å¤§å¤«å¦‚æœä¸æ¥ç›¸å¸«ï¼Œå°±æœƒè¢«ã€Œç¾¤èšè€Œç¬‘ä¹‹ã€ã€‚ä»–å€‘èªç‚ºå¹´ç´€ç›¸è‹¥çš„äººäº’ç›¸å­¸ç¿’æ˜¯ç¾æ¥çš„äº‹ï¼ˆä½å‘å‰‡è¶³ç¾ï¼Œå®˜ç››å‰‡è¿‘è«›ï¼‰ï¼Œé€™çœŸæ˜¯ç³Šå¡—å•Šï¼" }
                ],
                "å¸«é“åŸå‰‡": [
                    { q: "è€å¸«çš„ä½œç”¨æ˜¯ä»€éº¼ï¼Ÿ", a: "å¤ä¹‹å­¸è€…å¿…æœ‰å¸«ã€‚å¸«è€…ï¼Œæ‰€ä»¥å‚³é“ã€å—æ¥­ã€è§£æƒ‘ä¹Ÿã€‚ä¸åƒ…æ˜¯æ•™æ›¸ï¼Œæ›´æ˜¯å‚³æˆé“ç†å’Œè§£æ±ºäººç”Ÿçš„å›°æƒ‘ã€‚" },
                    { q: "é¸æ“‡è€å¸«æœ‰ä»€éº¼æ¨™æº–ï¼Ÿ", a: "è–äººç„¡å¸¸å¸«ã€‚æ¨™æº–åªæœ‰ä¸€å€‹ï¼šã€Œé“ä¹‹æ‰€å­˜ï¼Œå¸«ä¹‹æ‰€å­˜ä¹Ÿã€ã€‚ç„¡è«–åœ°ä½é«˜ä½ï¼ˆç„¡è²´ç„¡è³¤ï¼‰ã€å¹´ç´€å¤§å°ï¼ˆç„¡é•·ç„¡å°‘ï¼‰ï¼Œåªè¦ä»–æ‡‚å¾—é“ç†ï¼Œå°±æ˜¯æˆ‘çš„è€å¸«ã€‚" },
                    { q: "å¦‚æœä¸å¾å¸«æœƒæœ‰ä»€éº¼å¾Œæœï¼Ÿ", a: "äººéç”Ÿè€ŒçŸ¥ä¹‹è€…ï¼Œå­°èƒ½ç„¡æƒ‘ï¼Ÿå¦‚æœæœ‰ç–‘æƒ‘è€Œä¸å¾å¸«ï¼Œé‚£éº¼ã€Œå…¶ç‚ºæƒ‘ä¹Ÿçµ‚ä¸è§£çŸ£ã€ï¼Œé‚£äº›å›°æƒ‘å°‡æ°¸é ç„¡æ³•è§£é–‹ã€‚" }
                ],
                "æ‰¹è©•èˆ‡å°æ¯”": [
                    { q: "ä½ å¦‚ä½•çœ‹å¾…ã€Œå°å­¸è€Œå¤§éºã€ï¼Ÿ", a: "æ™‚äººç‚ºç«¥å­æ“‡å¸«æ•™å¥è®€ï¼ˆå­¸ç¿’æ–·å¥ï¼‰ï¼Œè‡ªå·±æœ‰ç–‘æƒ‘å»ä¸å¾å¸«ï¼Œé€™åªæ˜¯å­¸äº†å°çš„å­¸å•ï¼ˆå¥è®€ï¼‰ï¼Œå»éºæ¼äº†å¤§çš„å­¸å•ï¼ˆè§£æƒ‘ï¼‰ï¼Œå¾æœªè¦‹å…¶æ˜ä¹Ÿã€‚" },
                    { q: "ç‚ºä»€éº¼ä½ æåˆ°å·«é†«ã€æ¨‚å¸«ã€ç™¾å·¥ï¼Ÿ", a: "å› ç‚ºå·«é†«ã€æ¨‚å¸«ã€ç™¾å·¥ä¹‹äººï¼Œä»–å€‘ã€Œä¸æ¥ç›¸å¸«ã€ï¼Œäº’ç›¸å­¸ç¿’ã€‚åè§€å£«å¤§å¤«ä¹‹æ—å»æ¥æ–¼å¾å¸«ã€‚çµæœå£«å¤§å¤«çš„æ™ºæ…§åè€Œæ¯”ä¸ä¸Šä»–å€‘ï¼Œé€™ä¸æ˜¯å¾ˆå¥‡æ€ªå—ï¼ˆå…¶å¯æ€ªä¹Ÿæ­Ÿï¼‰ï¼Ÿ" }
                ]
            }
        },
        fanzhongyan: {
            name: "èŒƒä»²æ·¹",
            intro: "è€å¤«èŒƒä»²æ·¹ã€‚æ‡‰è¢«è²¶çš„å¥½å‹æ»•å­äº¬ä¹‹é‚€ï¼Œä½œã€Šå²³é™½æ¨“è¨˜ã€‹ã€‚ä½ å°æ­¤æ–‡æœ‰ä½•è¦‹è§£ï¼Ÿ",
            categories: {
                "äººç”ŸæŠ±è² ": [
                    { q: "ä½ å¿ƒä¸­çš„ç†æƒ³æŠ±è² æ˜¯ä»€éº¼ï¼Ÿ", a: "è€å¤«çš„å¿ƒé¡˜æ˜¯ã€Œå…ˆå¤©ä¸‹ä¹‹æ†‚è€Œæ†‚ï¼Œå¾Œå¤©ä¸‹ä¹‹æ¨‚è€Œæ¨‚ã€ã€‚åœ¨å¤©ä¸‹äººæ“”æ†‚ä¹‹å‰å…ˆæ“”æ†‚ï¼Œåœ¨å¤©ä¸‹äººå¿«æ¨‚ä¹‹å¾Œæ‰å¿«æ¨‚ã€‚" },
                    { q: "ä»€éº¼æ˜¯ã€Œå¤ä»äººä¹‹å¿ƒã€ï¼Ÿ", a: "å¤ä»äººä¹‹å¿ƒï¼Œå³æ˜¯ã€Œä¸ä»¥ç‰©å–œï¼Œä¸ä»¥å·±æ‚²ã€ã€‚ä¸å› ç‚ºå¤–åœ¨ç’°å¢ƒçš„å¥½å£æˆ–å€‹äººçš„å¾—å¤±è€Œæ„Ÿåˆ°é«˜èˆˆæˆ–æ‚²å‚·ã€‚" }
                ],
                "å¯«ä½œæ‰‹æ³•": [
                    { q: "ä½ æœ‰ä½¿ç”¨ä»€éº¼ã€Œå°æ¯”ã€æ‰‹æ³•ï¼Ÿ", a: "è€å¤«ç”¨äº†å¼·çƒˆçš„å°æ¯”ï¼šå°‡é™°é›¨é€£ç¶¿æ™‚çš„ã€Œæ„Ÿæ¥µè€Œæ‚²ã€èˆ‡æ˜¥å’Œæ™¯æ˜æ™‚çš„ã€Œå–œæ´‹æ´‹ã€ä½œå°æ¯”ã€‚å¤©æ°£å£æ™‚ã€Œæ¿æµªæ’ç©ºã€ï¼Œå¤©æ°£å¥½æ™‚ã€Œæ³¢ç€¾ä¸é©šã€ï¼›å‰è€…ä»¤äººã€Œæ†‚è®’ç•è­ã€ï¼Œå¾Œè€…ä»¤äººã€Œå¯µè¾±çš†å¿˜ã€ã€‚" },
                    { q: "ä»€éº¼æ˜¯ã€Œç›´æ¥ã€èˆ‡ã€Œé–“æ¥ã€æå¯«ï¼Ÿ", a: "å•å¾—å¥½ï¼ä¾‹å¦‚ã€Œæ˜¥å’Œæ™¯æ˜ã€æ˜¯ç›´æ¥æå¯«å¥½å¤©æ°£ã€‚è€Œå¯«ã€Œå•†æ—…ä¸è¡Œï¼Œæª£å‚¾æ¥«æ‘§ã€ï¼Œé›–ç„¶æ²’æœ‰ç›´æ¥å¯«é¢¨æµªå¤§ï¼Œä½†é€šéèˆ¹éš»ç„¡æ³•èˆªè¡Œã€èˆ¹æ¡…å‚¾å€’ï¼Œé–“æ¥çƒ˜æ‰˜å‡ºå¤©æ°£çš„æƒ¡åŠ£ã€‚" }
                ],
                "å¯«æ™¯æŠ’æƒ…": [
                    { q: "å¤©æ°£å£æ™‚ï¼Œæ™¯è‰²æ˜¯å¦‚ä½•ï¼Ÿ", a: "è‹¥å¤«éœªé›¨éœéœï¼Œé€£æœˆä¸é–‹ï¼Œé™°é¢¨æ€’è™Ÿï¼Œæ¿æµªæ’ç©ºã€‚é‚£æ™‚ç™»æ¨“æœƒæ„Ÿåˆ°ã€Œå»åœ‹æ‡·é„‰ï¼Œæ†‚è®’ç•è­ã€ï¼Œæ»¿ç›®è•­ç„¶ï¼Œæ„Ÿæ¥µè€Œæ‚²ã€‚" },
                    { q: "å¤©æ°£å¥½æ™‚ï¼Œæ™¯è‰²åˆæ˜¯å¦‚ä½•ï¼Ÿ", a: "è‡³è‹¥æ˜¥å’Œæ™¯æ˜ï¼Œæ³¢ç€¾ä¸é©šï¼Œä¸Šä¸‹å¤©å…‰ï¼Œä¸€ç¢§è¬é ƒã€‚é‚£æ™‚ç™»æ¨“æœƒæ„Ÿåˆ°ã€Œå¿ƒæ› ç¥æ€¡ï¼Œå¯µè¾±çš†å¿˜ã€ï¼ŒæŠŠé…’è‡¨é¢¨ï¼Œå…¶å–œæ´‹æ´‹è€…çŸ£ã€‚" }
                ]
            }
        },
        poets: {
            name: "å”ä»£è©©äºº",
            intro: "æˆ‘å€‘æ˜¯å”ä»£è©©äººæç™½ã€æœç”«èˆ‡ç‹ç¶­ã€‚ä½ æƒ³èˆ‡æˆ‘å€‘è«‡è«–è©©æ­Œå—ï¼Ÿ",
            categories: {
                "æç™½ (æœˆä¸‹ç¨é…Œ)": [
                    { q: "æç™½ï¼Œä½ ç‚ºä»€éº¼è¦ã€Œæœˆä¸‹ç¨é…Œã€ï¼Ÿ", a: "æç™½ï¼šå› ç‚ºçŸ¥éŸ³é›£å°‹ï¼Œæˆ‘åªèƒ½èˆ‡æœˆäº®å’Œå½±å­ç‚ºä¼´ï¼ˆæš«ä¼´æœˆå°‡å½±ï¼‰ã€‚é›–ç„¶æœˆäº®ä¸æ‡‚é£²é…’ï¼Œå½±å­åªæ˜¯éš¨èº«ï¼Œä½†æˆ‘ä»¥æ­¤å°‹æ±‚ç²¾ç¥è§£è„«ã€‚" },
                    { q: "è©©ä¸­æåˆ°çš„ã€Œä¸‰äººã€æ˜¯èª°ï¼Ÿ", a: "æç™½ï¼šé‚£æ˜¯æˆ‘ã€å¤©ä¸Šçš„æ˜æœˆï¼Œä»¥åŠåœ°ä¸Šçš„å½±å­ï¼ˆèˆ‰æ¯é‚€æ˜æœˆï¼Œå°å½±æˆä¸‰äººï¼‰ã€‚" }
                ],
                "æœç”« (ç™»æ¨“)": [
                    { q: "æœç”«ï¼Œä½ åœ¨ã€Šç™»æ¨“ã€‹ä¸­çœ‹è¦‹ä»€éº¼ï¼Ÿ", a: "æœç”«ï¼šæˆ‘ç™»é«˜æ¨“ï¼Œçœ‹è¦‹ã€ŒéŒ¦æ±Ÿæ˜¥è‰²ä¾†å¤©åœ°ã€ï¼Œæ™¯è‰²å£¯éº—ï¼Œä½†ã€Œç‰å£˜æµ®é›²è®Šå¤ä»Šã€ï¼Œä¸–äº‹è®Šå¹»ç„¡å¸¸ã€‚" },
                    { q: "ä½ å¦‚ä½•ã€Œå€Ÿå¤è«·ä»Šã€ï¼Ÿ", a: "æœç”«ï¼šæˆ‘æåˆ°ã€Œå¾Œä¸»é‚„ç¥ å»Ÿã€ï¼Œè¡¨é¢å¯«èœ€æ¼¢å¾Œä¸»åŠ‰ç¦ªï¼Œå¯¦å‰‡æ˜¯è«·åˆºç•¶ä»Šçš‡å¸å¯µä¿¡å®¦å®˜ï¼Œæ“”å¿ƒå”å®¤é‡è¹ˆè¦†è½ã€‚é€™ä¾¿æ˜¯å€Ÿå¤è«·ä»Šã€‚" }
                ],
                "ç‹ç¶­ (å±±å±…ç§‹æš)": [
                    { q: "ç‹ç¶­ï¼Œä½ å¦‚ä½•é‹ç”¨ã€Œå‹•éœçµåˆã€ï¼Ÿ", a: "ç‹ç¶­ï¼šä½ çœ‹ï¼Œã€Œæ˜æœˆæ¾é–“ç…§ã€æ˜¯éœæ™¯ï¼Œæ˜¯è¦–è¦ºæå¯«ï¼›ã€Œæ¸…æ³‰çŸ³ä¸Šæµã€æ˜¯å‹•æ™¯ã€‚è€Œã€Œç«¹å–§æ­¸æµ£å¥³ã€ä»¥å–§é¬§è²ï¼ˆè½è¦ºï¼‰åè¥¯å±±æ—çš„å¹½éœï¼Œé€™å°±æ˜¯ä»¥å‹•è¥¯éœã€‚" },
                    { q: "ä½ æƒ³è¡¨é”ä»€éº¼ä¸»æ—¨ï¼Ÿ", a: "ç‹ç¶­ï¼šæˆ‘æƒ³è¡¨é”å°å®˜å ´ç”Ÿæ´»çš„å­å€¦ï¼Œä»¥åŠå°éš±å±…ç”Ÿæ´»çš„å–œæ„›ï¼ˆéš¨æ„æ˜¥èŠ³æ­‡ï¼Œç‹å­«è‡ªå¯ç•™ï¼‰ã€‚" }
                ]
            }
        }
    };

    const db = [
        // --- å¸«èªª (å­—è©) ---
        { s: 'shishuo', t: 'vocab', q: `å¤ä¹‹å­¸è€…å¿…æœ‰${hl('å¸«')}`, a: 'ä¸€å®š' },
        { s: 'shishuo', t: 'vocab', q: `æ‰€ä»¥å‚³é“ã€${hl('å—')}æ¥­ã€è§£æƒ‘ä¹Ÿ`, a: '(åŒã€Œæˆã€)ï¼Œè¬›æˆ/æ•™æˆ' },
        { s: 'shishuo', t: 'vocab', q: `äººéç”Ÿè€ŒçŸ¥ä¹‹è€…ï¼Œ${hl('å­°')}èƒ½ç„¡æƒ‘ï¼Ÿ`, a: 'èª°/å“ªå€‹äºº/å“ªäº›äºº' },
        { s: 'shishuo', t: 'vocab', q: `${hl('å…¶')}ç‚ºæƒ‘ä¹Ÿçµ‚ä¸è§£çŸ£`, a: 'ä»–' },
        { s: 'shishuo', t: 'vocab', q: `${hl('å›º')}å…ˆä¹å¾ï¼Œå¾å¾è€Œå¸«ä¹‹`, a: 'æœ¬ä¾†' },
        { s: 'shishuo', t: 'vocab', q: `å¾å¸«é“ä¹Ÿï¼Œå¤«${hl('åº¸')}çŸ¥å…¶å¹´ä¹‹å…ˆå¾Œç”Ÿæ–¼å¾ä¹ï¼`, a: 'è±ˆ/å“ª/é›£é“' },
        { s: 'shishuo', t: 'vocab', q: `æ¬²äººä¹‹ç„¡${hl('æƒ‘')}ä¹Ÿé›£çŸ£ï¼`, a: 'å›°ç–‘/ç–‘æƒ‘(åè©)' },
        { s: 'shishuo', t: 'vocab', q: `å¤ä¹‹è–äººï¼Œå…¶${hl('å‡º')}äººä¹Ÿé çŸ£`, a: 'è¶…å‡º/è¶…è¶Š/è¶…é' },
        { s: 'shishuo', t: 'vocab', q: `${hl('çŒ¶ä¸”')}å¾å¸«è€Œå•ç„‰`, a: 'ä»ç„¶' },
        { s: 'shishuo', t: 'vocab', q: `ä»Šä¹‹çœ¾äººï¼Œå…¶${hl('ä¸‹')}è–äººä¹Ÿäº¦é çŸ£`, a: 'ä½æ–¼' },
        { s: 'shishuo', t: 'vocab', q: `æ˜¯æ•…è–${hl('ç›Š')}è–ï¼Œæ„šç›Šæ„š`, a: 'æ›´åŠ /è¶Šä¾†è¶Š' },
        { s: 'shishuo', t: 'vocab', q: `å…¶çš†å‡ºæ–¼æ­¤ä¹ï¼(${hl('å…¶')})`, a: 'å¤§æ¦‚(è¡¨ç¤ºä¼°è¨ˆ)' },
        { s: 'shishuo', t: 'vocab', q: `å…¶çš†${hl('å‡º')}æ–¼æ­¤ä¹ï¼`, a: 'å‡ºè‡ª' },
        { s: 'shishuo', t: 'vocab', q: `æ„›å…¶å­ï¼Œ${hl('æ“‡')}å¸«è€Œæ•™ä¹‹`, a: 'é¸æ“‡/æ€é¸/æŒ‘é¸' },
        { s: 'shishuo', t: 'vocab', q: `æ–¼å…¶èº«ä¹Ÿï¼Œå‰‡æ¥${hl('å¸«')}ç„‰ï¼Œæƒ‘çŸ£ï¼`, a: 'è·Ÿå¾è€å¸«å­¸ç¿’(åè©å‹•åŒ–)' },
        { s: 'shishuo', t: 'vocab', q: `${hl('å½¼')}ç«¥å­ä¹‹å¸«`, a: 'é‚£äº›' },
        { s: 'shishuo', t: 'vocab', q: `å½¼ç«¥å­ä¹‹å¸«ï¼Œ${hl('æˆ')}ä¹‹æ›¸è€Œç¿’å…¶å¥è®€è€…ä¹Ÿ`, a: 'æ•™æˆ/è¬›æˆ' },
        { s: 'shishuo', t: 'vocab', q: `æˆä¹‹æ›¸è€Œ${hl('ç¿’')}å…¶å¥è®€è€…ä¹Ÿ`, a: 'åå¾©ç·´ç¿’/è¤‡ç¿’/å­¸ç¿’/æ•ˆæ³•' },
        { s: 'shishuo', t: 'vocab', q: `å¥è®€ä¹‹ä¸çŸ¥ï¼Œæƒ‘ä¹‹${hl('ä¸è§£')}`, a: 'ä¸èƒ½è§£æ±º/ä¸èƒ½è§£é–‹' },
        { s: 'shishuo', t: 'vocab', q: `æˆ–å¸«ç„‰ï¼Œæˆ–${hl('ä¸')}ç„‰`, a: '(é€šã€Œå¦ã€)ï¼Œæ²’æœ‰' },
        { s: 'shishuo', t: 'vocab', q: `${hl('æˆ–')}å¸«ç„‰ï¼Œæˆ–ä¸ç„‰`, a: 'æœ‰äº›/æœ‰çš„' },
        { s: 'shishuo', t: 'vocab', q: `å¾æœªè¦‹å…¶${hl('æ˜')}ä¹Ÿ`, a: 'é«˜æ˜/è‹±æ˜/æ˜æ™º' },
        { s: 'shishuo', t: 'vocab', q: `å·«é†«ã€æ¨‚å¸«ã€ç™¾å·¥ä¹‹äººï¼Œä¸æ¥${hl('ç›¸')}å¸«`, a: 'äº’ç›¸' },
        { s: 'shishuo', t: 'vocab', q: `å‰‡${hl('ç¾¤')}èšè€Œç¬‘ä¹‹`, a: 'çœ¾/æˆç¾¤' },
        { s: 'shishuo', t: 'vocab', q: `${hl('å½¼')}èˆ‡å½¼å¹´ç›¸è‹¥ä¹Ÿ`, a: 'ä»–/ä»–å€‘/åˆ¥äºº/å°æ–¹' },
        { s: 'shishuo', t: 'vocab', q: `å½¼èˆ‡å½¼${hl('å¹´')}ç›¸è‹¥ä¹Ÿ`, a: 'å¹´ç´€/å¹´é½¡' },
        { s: 'shishuo', t: 'vocab', q: `ä½${hl('å‘')}å‰‡è¶³ç¾`, a: 'å‘å¾®/å‘ä¸‹' },
        { s: 'shishuo', t: 'vocab', q: `ä½å‘å‰‡è¶³${hl('ç¾')}ï¼Œå®˜ç››å‰‡è¿‘è«›`, a: 'ç¾æ¥' },
        { s: 'shishuo', t: 'vocab', q: `ä½å‘å‰‡è¶³ç¾ï¼Œå®˜ç››å‰‡è¿‘${hl('è«›')}`, a: '(é˜¿è«›)å¥‰æ‰¿/è«‚åªš' },
        { s: 'shishuo', t: 'vocab', q: `å¸«é“ä¹‹${hl('ä¸å¾©')}å¯çŸ¥çŸ£`, a: 'ä¸å†/ä¸èƒ½æ¢å¾©' },
        { s: 'shishuo', t: 'vocab', q: `å·«é†«ã€æ¨‚å¸«ã€ç™¾å·¥ä¹‹äººï¼Œå›å­${hl('ä¸é½’')}`, a: 'ä¸å±‘ä¸€æ/çœ‹ä¸èµ·' },
        { s: 'shishuo', t: 'vocab', q: `è–äººç„¡${hl('å¸¸')}å¸«`, a: 'å›ºå®šçš„' },
        { s: 'shishuo', t: 'vocab', q: `éƒ¯å­${hl('ä¹‹å¾’')}ï¼Œå…¶è³¢ä¸åŠå­”å­`, a: 'é€™äº›äºº' },
        { s: 'shishuo', t: 'vocab', q: `${hl('èé“')}æœ‰å…ˆå¾Œï¼Œè¡“æ¥­æœ‰å°ˆæ”»`, a: 'æ‡‚å¾—é“ç†' },
        { s: 'shishuo', t: 'vocab', q: `èé“æœ‰å…ˆå¾Œï¼Œ${hl('è¡“æ¥­')}æœ‰å°ˆæ”»`, a: 'å­¸è¡“/å­¸å•' },
        { s: 'shishuo', t: 'vocab', q: `è¡“æ¥­æœ‰å°ˆ${hl('æ”»')}`, a: 'é‘½ç ”/ç ”ç©¶' },
        { s: 'shishuo', t: 'vocab', q: `æå­èŸ ï¼Œå¹´åä¸ƒï¼Œ${hl('å¥½')}å¤æ–‡`, a: 'å–œæ„›' },
        { s: 'shishuo', t: 'vocab', q: `å…­è—ç¶“å‚³ï¼Œ${hl('çš†')}é€šç¿’ä¹‹`, a: 'éƒ½(å‰¯è©)' },
        { s: 'shishuo', t: 'vocab', q: `å…­è—ç¶“å‚³ï¼Œçš†${hl('é€š')}ç¿’ä¹‹`, a: 'å…¨éƒ¨(å½¢å®¹è©)' },
        { s: 'shishuo', t: 'vocab', q: `ä¸${hl('æ‹˜')}æ–¼æ™‚ï¼Œå­¸æ–¼ä½™`, a: 'é™åˆ¶/å—é™/æ‹˜æ³¥' },
        { s: 'shishuo', t: 'vocab', q: `ä¸æ‹˜æ–¼${hl('æ™‚')}ï¼Œå­¸æ–¼ä½™`, a: 'æ™‚ä¿—' },
        { s: 'shishuo', t: 'vocab', q: `ä½™${hl('å˜‰')}å…¶èƒ½è¡Œå¤é“`, a: 'è®šè¨±' },
        { s: 'shishuo', t: 'vocab', q: `ä½™å˜‰å…¶èƒ½${hl('è¡Œ')}å¤é“`, a: 'å¯¦è¡Œ/å¯¦è¸' },
        { s: 'shishuo', t: 'vocab', q: `ä½™å˜‰å…¶èƒ½è¡Œ${hl('å¤é“')}`, a: 'å¤ä»£(å¾å¸«)çš„é“ç†' },
        { s: 'shishuo', t: 'vocab', q: `ä½œã€ˆå¸«èªªã€‰ä»¥${hl('è²½')}ä¹‹`, a: 'è´ˆé€/é€è´ˆ' },
        
        // --- å¸«èªª (èªè­¯) ---
        { s: 'shishuo', t: 'trans', q: 'èªè­¯ï¼šæƒ‘è€Œä¸å¾å¸«ï¼Œå…¶ç‚ºæƒ‘ä¹Ÿçµ‚ä¸è§£çŸ£ã€‚', a: 'æœ‰ç–‘æƒ‘è€Œä¸(é¡˜æ„)è·Ÿå¾è€å¸«å­¸ç¿’ï¼Œä»–çš„ç–‘æƒ‘å§‹çµ‚ä¸èƒ½å¤ è§£æ±ºã€‚' },
        { s: 'shishuo', t: 'trans', q: 'èªè­¯ï¼šå¾å¸«é“ä¹Ÿï¼Œå¤«åº¸çŸ¥å…¶å¹´ä¹‹å…ˆå¾Œç”Ÿæ–¼å¾ä¹ï¼', a: 'æˆ‘å­¸ç¿’é“ç†ï¼Œå“ªè¦çŸ¥é“ä»–çš„å¹´ç´€æ˜¯å¦ç”Ÿæ–¼æˆ‘ä¹‹å‰ï¼' },
        { s: 'shishuo', t: 'trans', q: 'èªè­¯ï¼šå¥è®€ä¹‹ä¸çŸ¥ï¼Œæƒ‘ä¹‹ä¸è§£ï¼Œæˆ–å¸«ç„‰ï¼Œæˆ–ä¸ç„‰ã€‚', a: 'ä¸æ‡‚çš„å¥è®€ï¼Œæœ‰äº›äººå‘è€å¸«è«‹æ•™ï¼Œä¸èƒ½è§£æ±ºçš„å›°æƒ‘ï¼Œæœ‰äº›äººæ²’æœ‰å‘è€å¸«è«‹æ•™ã€‚' },
        { s: 'shishuo', t: 'trans', q: 'èªè­¯ï¼šå°å­¸è€Œå¤§éºï¼Œå¾æœªè¦‹å…¶æ˜ä¹Ÿã€‚', a: 'å­¸åˆ°å°çš„å­¸å•ä½†æ˜¯éºæ¼äº†é‡è¦çš„å­¸å•ï¼Œæˆ‘ä¸è¦‹å¾—ä»–å€‘é«˜æ˜çš„åœ°æ–¹ã€‚' },
        { s: 'shishuo', t: 'trans', q: 'èªè­¯ï¼šä»Šå…¶æ™ºä¹ƒåä¸èƒ½åŠï¼Œå…¶å¯æ€ªä¹Ÿæ­Ÿï¼', a: 'ç¾ä»Šä»–å€‘çš„æ™ºæ…§åè€ŒåŠä¸ä¸Šå·«é†«æ¨‚å¸«ï¼Œé€™ä¸æ˜¯å¾ˆå¥‡æ€ªå—ï¼Ÿ' },

        // --- å¸«èªª (ä¸»æ—¨) ---
        { 
            s: 'shishuo', 
            t: 'main', 
            q: 'ã€ˆå¸«èªªã€‰çš„ä¸»æ—¨æ˜¯ä»€éº¼ï¼Ÿ', 
            a: 'é€šéæ’°å¯«æ–‡ç« è´ˆé€å¼Ÿå­æèŸ ï¼Œä»¥åŠåˆ†ææ™‚äººå¾å¸«å­¸ç¿’çš„æƒ…æ³ï¼Œèªªæ˜è€å¸«çš„è·è²¬ã€å¾å¸«è€Œå­¸çš„é‡è¦æ€§åŠæ“‡å¸«çš„åŸå‰‡ï¼Œå¾è€Œæ‰¹è©•ç•¶æ™‚å£«å¤§å¤«æ¥æ–¼å¾å¸«æ±‚å­¸çš„éŒ¯èª¤è§€å¿µï¼Œä¸¦å€¡å°å¾å¸«è€Œå­¸çš„é¢¨æ°£ã€‚',
            customDistractors: [
                'é€šéæè¿°æ˜¥å¤©å‚æ™šç™»æ¨“æ™‚æ‰€è¦‹çš„æ™¯è‰²ï¼Œè¡¨é”å°å”å®¤çµ±æ²»çš„æ“”å¿ƒï¼Œä¸¦è‡ªå‚·æ²’æœ‰å ±æ•ˆæœå»·çš„æ©Ÿæœƒï¼ŒæŠ’ç™¼äº†æ†‚åœ‹æ†‚æ°‘çš„æƒ…æ‡·ã€‚',
                'é€éæå¯«å±±é–“ç§‹å¤œé›¨å¾Œçš„å„ªç¾æ™¯è‰²åŠå¹½éœæ°£æ°›ï¼Œæµéœ²å°å±±å±…ç”Ÿæ´»çš„å–œæ„›ï¼Œä¸¦å±•ç¾ä½›å®¶ç©ºéœçš„å¢ƒç•Œï¼Œåæ˜ ä½œè€…å­å€¦å®˜å ´ç”Ÿæ´»ã€‚',
                'é€šéæå¯«å²³é™½æ¨“çš„æ™¯è‰²åŠé·å®¢é¨·äººç™»æ¨“è¦½æ™¯æ‰€ç”¢ç”Ÿçš„ä¸åŒæƒ…æ‡·ï¼ŒæŠ’ç™¼ä½œè€…ã€Œä¸ä»¥ç‰©å–œï¼Œä¸ä»¥å·±æ‚²ã€çš„åšå¤§èƒ¸è¥Ÿã€‚'
            ]
        },

        // --- å²³é™½æ¨“è¨˜ (å­—è©) ---
        { s: 'yueyang', t: 'vocab', q: `æ»•å­äº¬${hl('å®ˆ')}å·´é™µéƒ¡`, a: 'è¢«é™è·/è¢«è²¶å®˜' },
        { s: 'yueyang', t: 'vocab', q: `${hl('è¶Š')}æ˜å¹´ï¼Œæ”¿é€šäººå’Œï¼Œç™¾å»¢å…·èˆˆ`, a: 'åŠ/åˆ°/åˆ°äº†' },
        { s: 'yueyang', t: 'vocab', q: `æ”¿é€šä»${hl('å’Œ')}ï¼Œç™¾å»¢å…·èˆˆ`, a: 'å’Œè«§/å’Œç¦' },
        { s: 'yueyang', t: 'vocab', q: `æ”¿é€šäººå’Œï¼Œç™¾å»¢${hl('å…·')}èˆˆ`, a: '(é€šã€Œä¿±ã€)ï¼Œéƒ½/çš†' },
        { s: 'yueyang', t: 'vocab', q: `${hl('ä¹ƒ')}é‡ä¿®å²³é™½æ¨“`, a: 'æ–¼æ˜¯' },
        { s: 'yueyang', t: 'vocab', q: `${hl('å±¬')}äºˆä½œæ–‡ä»¥è¨˜ä¹‹`, a: '(åŒã€Œå›‘ã€)ï¼Œå›‘å’' },
        { s: 'yueyang', t: 'vocab', q: `å±¬${hl('äºˆ')}ä½œæ–‡ä»¥è¨˜ä¹‹`, a: 'æˆ‘' },
        { s: 'yueyang', t: 'vocab', q: `äºˆè§€å¤«å·´é™µ${hl('å‹')}ç‹€`, a: 'å„ªç¾' },
        { s: 'yueyang', t: 'vocab', q: `${hl('éŠœ')}é å±±ï¼Œåé•·æ±Ÿ`, a: '(åŒã€Œå«ã€)å«è‘—' },
        { s: 'yueyang', t: 'vocab', q: `æµ©æµ©æ¹¯æ¹¯ï¼Œ${hl('æ©«')}ç„¡éš›æ¶¯`, a: 'æ°´å‹¢æ´¶æ¹§ï¼Œæ³¢ç€¾å£¯é—Š' },
        { s: 'yueyang', t: 'vocab', q: `å‰äººä¹‹è¿°${hl('å‚™')}çŸ£`, a: 'è©³ç›¡/å®Œå‚™' },
        { s: 'yueyang', t: 'vocab', q: `ç„¶å‰‡åŒ—é€šå·«å³½ï¼Œå—${hl('æ¥µ')}ç€Ÿæ¹˜`, a: 'åˆ°é”ç›¡é ­' },
        { s: 'yueyang', t: 'vocab', q: `é·å®¢é¨·äººï¼Œå¤š${hl('æœƒ')}æ–¼æ­¤`, a: 'èšé›†' },
        { s: 'yueyang', t: 'vocab', q: `è¦½ç‰©ä¹‹æƒ…ï¼Œ${hl('å¾—ç„¡')}ç•°ä¹ï¼Ÿ`, a: 'èƒ½ä¸/é›£é“æ²’æœ‰' },
        { s: 'yueyang', t: 'vocab', q: `è‹¥ä¹éœªé›¨éœéœï¼Œé€£æœˆä¸${hl('é–‹')}`, a: 'æ”¾æ™´ (åŸæ–‡å°æ‡‰:éé‡/ä¹…é›¨)' },
        { s: 'yueyang', t: 'vocab', q: `é™°é¢¨${hl('æ€’è™Ÿ')}ï¼Œæ¿æµªæ’ç©º`, a: 'å¼·å‹/çŒ›çƒˆ' },
        { s: 'yueyang', t: 'vocab', q: `é™°é¢¨æ€’è™Ÿï¼Œæ¿æµªæ’ç©º (${hl('è™Ÿ')})`, a: 'å‘¼å˜¯' },
        { s: 'yueyang', t: 'vocab', q: `é™°é¢¨æ€’è™Ÿï¼Œæ¿æµª${hl('æ’')}ç©º`, a: 'è¡å‘' },
        { s: 'yueyang', t: 'vocab', q: `æ—¥æ˜Ÿéš±è€€ï¼Œå±±å²³${hl('æ½›')}å½¢`, a: 'éš±è—' },
        { s: 'yueyang', t: 'vocab', q: `å•†æ—…ä¸è¡Œï¼Œ${hl('æª£')}å‚¾æ¥«æ‘§`, a: 'èˆ¹æ¡…' },
        { s: 'yueyang', t: 'vocab', q: `å•†æ—…ä¸è¡Œï¼Œæª£å‚¾${hl('æ¥«')}æ‘§`, a: 'èˆ¹æ§³' },
        { s: 'yueyang', t: 'vocab', q: `å‰‡æœ‰${hl('å»')}åœ‹æ‡·é„‰ï¼Œæ†‚è®’ç•è­`, a: 'é›¢é–‹' },
        { s: 'yueyang', t: 'vocab', q: `å‰‡æœ‰å»åœ‹æ‡·é„‰ï¼Œæ†‚${hl('è®’')}ç•è­`, a: 'è®’è¨€' },
        { s: 'yueyang', t: 'vocab', q: `å‰‡æœ‰å»åœ‹æ‡·é„‰ï¼Œæ†‚è®’ç•${hl('è­')}`, a: 'è­è«·' },
        { s: 'yueyang', t: 'vocab', q: `æ»¿ç›®è•­ç„¶ï¼Œæ„Ÿæ¥µè€Œ${hl('æ‚²')}è€…çŸ£`, a: 'æ„Ÿæ…¨' },
        { s: 'yueyang', t: 'vocab', q: `æ»¿ç›®è•­ç„¶ï¼Œæ„Ÿ${hl('æ¥µ')}è€Œæ‚²è€…çŸ£`, a: 'æœ€/éå¸¸' },
        { s: 'yueyang', t: 'vocab', q: `${hl('è‡³è‹¥')}æ˜¥å’Œæ™¯æ˜`, a: 'è‡³æ–¼/åˆå¦‚' },
        { s: 'yueyang', t: 'vocab', q: `è‡³è‹¥æ˜¥å’Œ${hl('æ™¯')}æ˜ï¼Œæ³¢ç€¾ä¸é©š`, a: 'å¤©æ°£æš–å’Œ (æ—¥å…‰)' },
        { s: 'yueyang', t: 'vocab', q: `æ³¢ç€¾ä¸${hl('é©š')}`, a: 'èµ·/å‹•' },
        { s: 'yueyang', t: 'vocab', q: `æ²™é·—ç¿”${hl('é›†')}ï¼ŒéŒ¦é±—æ¸¸æ³³`, a: 'èšé›†/æ£²æ¯' },
        { s: 'yueyang', t: 'vocab', q: `å²¸èŠ·æ±€è˜­ï¼Œ${hl('éƒéƒ')}é’é’`, a: '(åŒã€Œèèã€)ï¼ŒèŠ±è‘‰èŒ‚ç››' },
        { s: 'yueyang', t: 'vocab', q: `è€Œ${hl('æˆ–')}é•·ç…™ä¸€ç©º`, a: 'æœ‰æ™‚/æœ‰æ™‚å€™' },
        { s: 'yueyang', t: 'vocab', q: `è€Œæˆ–é•·ç…™ä¸€ç©ºï¼Œ${hl('çš“')}æœˆåƒé‡Œ`, a: 'å…‰æ˜/æ˜äº®' },
        { s: 'yueyang', t: 'vocab', q: `ç™»${hl('æ–¯')}æ¨“ä¹Ÿ`, a: 'é€™/æ­¤' },
        { s: 'yueyang', t: 'vocab', q: `å‰‡æœ‰å¿ƒ${hl('æ› ')}ç¥æ€¡ï¼Œå¯µè¾±çš†å¿˜`, a: 'é–‹æœ—' },
        { s: 'yueyang', t: 'vocab', q: `å‰‡æœ‰å¿ƒæ› ç¥${hl('æ€¡')}ï¼Œå¯µè¾±çš†å¿˜`, a: 'å’Œæ‚…/æ„‰å¿«' },
        { s: 'yueyang', t: 'vocab', q: `å¯µè¾±çš†å¿˜ï¼Œ${hl('æŠŠ')}é…’è‡¨é¢¨`, a: 'æ‹¿è‘—' },
        { s: 'yueyang', t: 'vocab', q: `å¯µè¾±çš†å¿˜ï¼ŒæŠŠé…’${hl('è‡¨')}é¢¨`, a: 'é¢å°è‘—' },
        { s: 'yueyang', t: 'vocab', q: `äºˆ${hl('å˜—')}æ±‚å¤ä»äººä¹‹å¿ƒ`, a: 'æ›¾ç¶“/æ›¾' },
        { s: 'yueyang', t: 'vocab', q: `äºˆå˜—${hl('æ±‚')}å¤ä»äººä¹‹å¿ƒ`, a: 'æ¢æ±‚' },
        { s: 'yueyang', t: 'vocab', q: `${hl('æˆ–')}ç•°äºŒè€…ä¹‹ç‚º`, a: 'æˆ–è€…/æˆ–è¨±' },
        { s: 'yueyang', t: 'vocab', q: `æˆ–ç•°äºŒè€…ä¹‹${hl('ç‚º')}`, a: 'è¡Œç‚º/è¡¨ç¾' },
        { s: 'yueyang', t: 'vocab', q: `${hl('å±…')}å»Ÿå ‚ä¹‹é«˜ï¼Œå‰‡æ†‚å…¶æ°‘ã€‚`, a: 'è™•æ–¼/èº«å±…/èº«åœ¨' },
        { s: 'yueyang', t: 'vocab', q: `å±…${hl('å»Ÿå ‚')}ä¹‹é«˜ï¼Œå‰‡æ†‚å…¶æ°‘ã€‚`, a: 'å€Ÿä»£æœå»·' },
        { s: 'yueyang', t: 'vocab', q: `${hl('è™•')}æ±Ÿæ¹–ä¹‹é ï¼Œå‰‡æ†‚å…¶å›ã€‚`, a: 'å±…ä½/è™•æ–¼' },
        { s: 'yueyang', t: 'vocab', q: `è™•${hl('æ±Ÿæ¹–')}ä¹‹é ï¼Œå‰‡æ†‚å…¶å›ã€‚`, a: 'å€Ÿä»£æ°‘é–“' },
        { s: 'yueyang', t: 'vocab', q: `${hl('æ˜¯')}é€²äº¦æ†‚ï¼Œé€€äº¦æ†‚`, a: 'é€™æ¨£/å› æ­¤' },
        { s: 'yueyang', t: 'vocab', q: `${hl('ç„¶å‰‡')}ä½•æ™‚è€Œæ¨‚è€¶ï¼Ÿ`, a: 'é‚£éº¼' },
        { s: 'yueyang', t: 'vocab', q: `${hl('å¾®')}æ–¯äººï¼Œå¾èª°èˆ‡æ­¸ï¼`, a: '(å¦‚æœ)æ²’æœ‰' },
        { s: 'yueyang', t: 'vocab', q: `å¾®æ–¯äººï¼Œå¾èª°èˆ‡${hl('æ­¸')}ï¼`, a: 'æ­¸ä¾/æ•ˆæ³•/åŒé“' },

        // --- å²³é™½æ¨“è¨˜ (èªè­¯) ---
        { s: 'yueyang', t: 'trans', q: 'èªè­¯ï¼šæ­¤å‰‡å²³é™½æ¨“ä¹‹å¤§è§€ä¹Ÿï¼Œå‰äººä¹‹è¿°å‚™çŸ£ã€‚', a: 'é€™å°±æ˜¯åœ¨å²³é™½æ¨“ä¸Šæ‰€è¦‹åˆ°çš„å£¯è§€æ™¯è±¡ï¼Œä»¥å‰çš„äººçš„æè¿°å·²ç¶“å¾ˆè©³ç›¡äº†ã€‚' },
        { s: 'yueyang', t: 'trans', q: 'èªè­¯ï¼šæ˜¯é€²äº¦æ†‚ï¼Œé€€äº¦æ†‚ï¼›ç„¶å‰‡ä½•æ™‚è€Œæ¨‚è€¶ï¼Ÿ', a: 'é€™æ¨£åœ¨æœå»·ä»»å®˜ä¹Ÿæ†‚æ…®ï¼Œæ­¸éš±ä¹Ÿæ†‚æ…®ï¼›é‚£éº¼è¦åˆ°ä»€éº¼æ™‚å€™æ‰å¿«æ¨‚å‘¢ï¼Ÿ' },
        { s: 'yueyang', t: 'trans', q: 'èªè­¯ï¼šå¾®æ–¯äººï¼Œå¾èª°èˆ‡æ­¸ï¼Ÿ', a: 'å¦‚æœæ²’æœ‰é€™æ¨£çš„äººï¼Œæˆ‘å¯ä»¥å’Œèª°ä¸€èµ·å‘¢ï¼Ÿ' },
        
        // --- å²³é™½æ¨“è¨˜ (ä¸»æ—¨) ---
        { 
            s: 'yueyang', 
            t: 'main', 
            q: 'ã€Šå²³é™½æ¨“è¨˜ã€‹çš„ä¸»æ—¨æ˜¯ä»€éº¼ï¼Ÿ', 
            a: 'é€šéæå¯«å²³é™½æ¨“çš„æ™¯è‰²åŠé·å®¢é¨·äººç™»æ¨“è¦½æ™¯æ‰€ç”¢ç”Ÿçš„ä¸åŒæƒ…æ‡·ï¼ŒæŠ’ç™¼ä½œè€…ã€Œä¸ä»¥ç‰©å–œï¼Œä¸ä»¥å·±æ‚²ã€çš„åšå¤§èƒ¸è¥Ÿï¼Œä»¥åŠã€Œå…ˆå¤©ä¸‹ä¹‹æ†‚è€Œæ†‚ï¼Œå¾Œå¤©ä¸‹ä¹‹æ¨‚è€Œæ¨‚ã€çš„æ”¿æ²»æŠ±è² ï¼Œä¸¦è—‰æ­¤å‹‰å‹µå‹äººæ»•å­äº¬ã€‚',
            customDistractors: [
                'é€šéæè¿°æ˜¥å¤©å‚æ™šç™»æ¨“æ™‚æ‰€è¦‹çš„æ™¯è‰²ï¼Œè¡¨é”å°å”å®¤çµ±æ²»çš„æ“”å¿ƒï¼Œä¸¦è‡ªå‚·æ²’æœ‰å ±æ•ˆæœå»·çš„æ©Ÿæœƒï¼ŒæŠ’ç™¼äº†æ†‚åœ‹æ†‚æ°‘çš„æƒ…æ‡·ã€‚',
                'é€šéæ’°å¯«æ–‡ç« è´ˆé€å¼Ÿå­ï¼Œèªªæ˜è€å¸«çš„è·è²¬ã€å¾å¸«è€Œå­¸çš„é‡è¦æ€§åŠæ“‡å¸«çš„åŸå‰‡ï¼Œæ‰¹è©•ç•¶æ™‚å£«å¤§å¤«æ¥æ–¼å¾å¸«æ±‚å­¸çš„éŒ¯èª¤è§€å¿µã€‚',
                'é€šéæè¿°ç¨è‡ªåœ¨èŠ±é–“é‚€è«‹æœˆäº®åŠèº«å½±é£²é…’ï¼Œèªªå‡ºåœ¨è‰¯è¾°ç¾æ™¯ä¸‹ç„¡ä¼´çš„å­¤å¯‚ï¼ŒæŠ’ç™¼å£¯å¿—é›£é…¬èˆ‡çŸ¥éŸ³é›£å°‹çš„å­¤ç¨é¬±æ‚¶ã€‚'
            ]
        },

        // --- è©©ä¸‰é¦– (å­—è©) ---
        { s: 'poems', t: 'vocab', q: `æš«ä¼´æœˆ${hl('å°‡')}å½± (æœˆä¸‹ç¨é…Œ)`, a: 'èˆ‡/å’Œ' },
        { s: 'poems', t: 'vocab', q: `æœˆæ—¢ä¸${hl('è§£')}é£² (æœˆä¸‹ç¨é…Œ)`, a: 'æ˜ç™½/æ‡‚å¾—' },
        { s: 'poems', t: 'vocab', q: `ç›¸æœŸ${hl('é‚ˆ')}é›²æ¼¢ (æœˆä¸‹ç¨é…Œ)`, a: 'é™é (çš„)' },
        { s: 'poems', t: 'vocab', q: `ç¨${hl('é…Œ')}ç„¡ç›¸è¦ª (æœˆä¸‹ç¨é…Œ)`, a: 'é£²é…’' },
        { s: 'poems', t: 'vocab', q: `å½±${hl('å¾’')}éš¨æˆ‘èº« (æœˆä¸‹ç¨é…Œ)`, a: 'åª/åƒ…åƒ…/ç™½ç™½åœ°' },
        { s: 'poems', t: 'vocab', q: `${hl('ç›¸æœŸ')}é‚ˆé›²æ¼¢ (æœˆä¸‹ç¨é…Œ)`, a: 'ç›¸ç´„' },
        { s: 'poems', t: 'vocab', q: `ç›¸æœŸé‚ˆ${hl('é›²æ¼¢')} (æœˆä¸‹ç¨é…Œ)`, a: 'éŠ€æ²³' },
        { s: 'poems', t: 'vocab', q: `è¡Œæ¨‚é ˆ${hl('åŠ')}æ˜¥ (æœˆä¸‹ç¨é…Œ)`, a: 'è¶è‘—' },
        { s: 'poems', t: 'vocab', q: `å¯æ†å¾Œä¸»${hl('é‚„')}ç¥ å»Ÿ (ç™»æ¨“)`, a: 'ä»/å°š(æœ‰)' },
        { s: 'poems', t: 'vocab', q: `æ—¥æš®${hl('èŠ')}ç‚ºæ¢ç”«åŸ (ç™»æ¨“)`, a: 'å§‘ä¸”' },
        { s: 'poems', t: 'vocab', q: `è¥¿å±±å¯‡ç›œè«${hl('ç›¸')}ä¾µ (ç™»æ¨“)`, a: '(åæŒ‡ä¸€æ–¹)' },
        { s: 'poems', t: 'vocab', q: `åŒ—æ¥µæœå»·${hl('çµ‚')}ä¸æ”¹ (ç™»æ¨“)`, a: 'å§‹çµ‚/æœ€çµ‚' },
        { s: 'poems', t: 'vocab', q: `${hl('æ—¥æš®')}èŠç‚ºæ¢ç”«åŸ (ç™»æ¨“)`, a: 'é»ƒæ˜/å‚æ™š' },
        { s: 'poems', t: 'vocab', q: `è¬æ–¹å¤š${hl('é›£')}æ­¤ç™»è‡¨ (ç™»æ¨“)`, a: 'æ†‚æ‚£/æ‚£é›£/ç½é›£' },
        { s: 'poems', t: 'vocab', q: `éŒ¦æ±Ÿæ˜¥è‰²${hl('ä¾†')}å¤©åœ° (ç™»æ¨“)`, a: 'ä¾†è‡¨' },
        { s: 'poems', t: 'vocab', q: `ç©ºå±±${hl('æ–°')}é›¨å¾Œ (å±±å±…ç§‹æš)`, a: 'å‰›å‰›' },
        { s: 'poems', t: 'vocab', q: `éš¨æ„æ˜¥èŠ³${hl('æ­‡')} (å±±å±…ç§‹æš)`, a: 'å‡‹è¬/å‡‹é›¶' },
        { s: 'poems', t: 'vocab', q: `ç«¹å–§æ­¸${hl('æµ£å¥³')} (å±±å±…ç§‹æš)`, a: 'æ´—è¡£æœçš„å¥³å­' },
        { s: 'poems', t: 'vocab', q: `${hl('éš¨æ„')}æ˜¥èŠ³æ­‡ (å±±å±…ç§‹æš)`, a: 'ä»»ç”±/ä»»æ†‘' },
        { s: 'poems', t: 'vocab', q: `ç«¹${hl('å–§')}æ­¸æµ£å¥³ (å±±å±…ç§‹æš)`, a: 'å–§é¬§/åµé¬§(è²)' },
        
        // --- è©©ä¸‰é¦– (ä¸»æ—¨) ---
        { 
            s: 'poems', 
            t: 'main', 
            q: 'ã€Šæœˆä¸‹ç¨é…Œã€‹çš„ä¸»æ—¨æ˜¯ä»€éº¼ï¼Ÿ', 
            a: 'æŠ’ç™¼å£¯å¿—é›£é…¬èˆ‡çŸ¥éŸ³é›£å°‹çš„å­¤ç¨é¬±æ‚¶ï¼Œä¸¦æ¸´æœ›ä»¥é“å®¶å¿˜æƒ…éŠç‚ºç²¾ç¥è§£è„«ã€‚',
            customDistractors: [
                'é€šéæå¯«å²³é™½æ¨“çš„æ™¯è‰²åŠé·å®¢é¨·äººç™»æ¨“è¦½æ™¯æ‰€ç”¢ç”Ÿçš„ä¸åŒæƒ…æ‡·ï¼ŒæŠ’ç™¼ä½œè€…ã€Œä¸ä»¥ç‰©å–œï¼Œä¸ä»¥å·±æ‚²ã€çš„åšå¤§èƒ¸è¥Ÿã€‚',
                'é€šéæè¿°æ˜¥å¤©å‚æ™šç™»æ¨“æ™‚æ‰€è¦‹çš„æ™¯è‰²ï¼Œè¡¨é”å°å”å®¤çµ±æ²»çš„æ“”å¿ƒï¼Œä¸¦è‡ªå‚·æ²’æœ‰å ±æ•ˆæœå»·çš„æ©Ÿæœƒã€‚',
                'æµéœ²å°å±±å±…ç”Ÿæ´»çš„å–œæ„›ï¼Œå±•ç¾ä½›å®¶ç©ºéœçš„å¢ƒç•Œï¼Œåæ˜ å­å€¦å®˜å ´åŠåš®å¾€éš±å±…ç”Ÿæ´»ã€‚'
            ]
        },
        { 
            s: 'poems', 
            t: 'main', 
            q: 'ã€Šç™»æ¨“ã€‹çš„ä¸»æ—¨æ˜¯ä»€éº¼ï¼Ÿ', 
            a: 'è¡¨é”å°å”å®¤çµ±æ²»çš„æ“”å¿ƒï¼Œè‡ªå‚·æ²’æœ‰å ±æ•ˆæœå»·çš„æ©Ÿæœƒï¼ŒæŠ’ç™¼æ†‚åœ‹æ†‚æ°‘çš„æƒ…æ‡·ã€‚',
            customDistractors: [
                'æŠ’ç™¼å£¯å¿—é›£é…¬èˆ‡çŸ¥éŸ³é›£å°‹çš„å­¤ç¨é¬±æ‚¶ï¼Œä¸¦æ¸´æœ›ä»¥é“å®¶å¿˜æƒ…éŠç‚ºç²¾ç¥è§£è„«ã€‚',
                'é€šéæ’°å¯«æ–‡ç« è´ˆé€å¼Ÿå­ï¼Œèªªæ˜è€å¸«çš„è·è²¬ã€å¾å¸«è€Œå­¸çš„é‡è¦æ€§åŠæ“‡å¸«çš„åŸå‰‡ã€‚',
                'æµéœ²å°å±±å±…ç”Ÿæ´»çš„å–œæ„›ï¼Œå±•ç¾ä½›å®¶ç©ºéœçš„å¢ƒç•Œï¼Œåæ˜ å­å€¦å®˜å ´åŠåš®å¾€éš±å±…ç”Ÿæ´»ã€‚'
            ]
        },
        { 
            s: 'poems', 
            t: 'main', 
            q: 'ã€Šå±±å±…ç§‹æšã€‹çš„ä¸»æ—¨æ˜¯ä»€éº¼ï¼Ÿ', 
            a: 'æµéœ²å°å±±å±…ç”Ÿæ´»çš„å–œæ„›ï¼Œå±•ç¾ä½›å®¶ç©ºéœçš„å¢ƒç•Œï¼Œåæ˜ å­å€¦å®˜å ´åŠåš®å¾€éš±å±…ç”Ÿæ´»ã€‚',
            customDistractors: [
                'è¡¨é”å°å”å®¤çµ±æ²»çš„æ“”å¿ƒï¼Œè‡ªå‚·æ²’æœ‰å ±æ•ˆæœå»·çš„æ©Ÿæœƒï¼ŒæŠ’ç™¼æ†‚åœ‹æ†‚æ°‘çš„æƒ…æ‡·ã€‚',
                'é€šéæå¯«å²³é™½æ¨“çš„æ™¯è‰²åŠé·å®¢é¨·äººç™»æ¨“è¦½æ™¯æ‰€ç”¢ç”Ÿçš„ä¸åŒæƒ…æ‡·ï¼ŒæŠ’ç™¼ä½œè€…ã€Œä¸ä»¥ç‰©å–œï¼Œä¸ä»¥å·±æ‚²ã€çš„åšå¤§èƒ¸è¥Ÿã€‚',
                'æŠ’ç™¼å£¯å¿—é›£é…¬èˆ‡çŸ¥éŸ³é›£å°‹çš„å­¤ç¨é¬±æ‚¶ï¼Œä¸¦æ¸´æœ›ä»¥é“å®¶å¿˜æƒ…éŠç‚ºç²¾ç¥è§£è„«ã€‚'
            ]
        }
    ];

    // ================= STATE & LOGIC =================
    let currentQuiz = [];
    let currentIndex = 0;
    let score = 0;
    let isAnswered = false;

    // Helpers
    const shuffleArray = (array) => {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    };

    const getDistractors = (item, count = 3) => {
        if (item.customDistractors && item.customDistractors.length > 0) {
            let pool = [...item.customDistractors];
            shuffleArray(pool);
            return pool.slice(0, count);
        }
        let pool = db.filter(i => i.t === item.t && i.a !== item.a);
        if (pool.length < count) pool = db.filter(i => i.a !== item.a);
        shuffleArray(pool);
        return pool.slice(0, count).map(i => i.a);
    };

    // Screens
    const menuScreen = document.getElementById('menu-screen');
    const quizScreen = document.getElementById('quiz-screen');
    const resultScreen = document.getElementById('result-screen');
    const chatSelectionScreen = document.getElementById('chat-selection');
    const chatScreen = document.getElementById('chat-screen');
    
    // Elements
    const qText = document.getElementById('question-text');
    const optsContainer = document.getElementById('options-container');
    const feedback = document.getElementById('feedback-area');
    const nextBtn = document.getElementById('next-btn');
    const finishBtn = document.getElementById('finish-btn');
    const qCounter = document.getElementById('question-counter');
    const sCounter = document.getElementById('score-counter');
    const pFill = document.getElementById('progress-fill');

    function hideAllScreens() {
        menuScreen.style.display = 'none';
        quizScreen.style.display = 'none';
        resultScreen.style.display = 'none';
        chatSelectionScreen.style.display = 'none';
        chatScreen.style.display = 'none';
    }

    function startQuiz(scope) {
        if (scope === 'all') {
            currentQuiz = [...db];
        } else {
            currentQuiz = db.filter(item => item.s === scope);
        }
        shuffleArray(currentQuiz);
        currentIndex = 0;
        score = 0;
        isAnswered = false;

        hideAllScreens();
        quizScreen.style.display = 'block';
        renderQuestion();
    }

    function renderQuestion() {
        if (currentIndex >= currentQuiz.length) {
            showResults();
            return;
        }

        const item = currentQuiz[currentIndex];
        isAnswered = false;

        qCounter.innerText = `é¡Œç›®: ${currentIndex + 1} / ${currentQuiz.length}`;
        sCounter.innerText = `å¾—åˆ†: ${score}`;
        const pct = ((currentIndex) / currentQuiz.length) * 100;
        pFill.style.width = `${pct}%`;

        qText.innerHTML = item.q;
        feedback.innerText = '';
        nextBtn.classList.add('hidden');
        finishBtn.classList.add('hidden');

        const distractors = getDistractors(item);
        const allOptions = [...distractors, item.a];
        shuffleArray(allOptions);

        optsContainer.innerHTML = '';
        allOptions.forEach(opt => {
            const btn = document.createElement('div');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => handleAnswer(btn, opt, item.a);
            optsContainer.appendChild(btn);
        });
    }

    function handleAnswer(btn, selected, correct) {
        if (isAnswered) return;
        isAnswered = true;

        const allBtns = optsContainer.children;
        
        if (selected === correct) {
            btn.classList.add('correct');
            feedback.innerHTML = '<span style="color:var(--success); font-weight:bold;">âœ… ç­”å°äº†ï¼</span>';
            score++;
            sCounter.innerText = `å¾—åˆ†: ${score}`;
        } else {
            btn.classList.add('incorrect');
            for (let b of allBtns) {
                if (b.innerText === correct) b.classList.add('correct');
            }
            feedback.innerHTML = `<span style="color:var(--danger); font-weight:bold;">âŒ ç­”éŒ¯äº†ã€‚</span> æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š<br>${correct}`;
        }

        if (currentIndex < currentQuiz.length - 1) {
            nextBtn.classList.remove('hidden');
        } else {
            finishBtn.classList.remove('hidden');
        }
    }

    function nextQuestion() {
        currentIndex++;
        renderQuestion();
    }

    function showResults() {
        hideAllScreens();
        resultScreen.style.display = 'block';
        
        const percentage = Math.round((score / currentQuiz.length) * 100);
        document.getElementById('final-score').innerText = `${percentage}%`;
        pFill.style.width = '100%';

        let msg = '';
        if (percentage === 100) msg = 'å®Œç¾ï¼ä½ æ˜¯ç‹€å…ƒå—ï¼ŸğŸ†';
        else if (percentage >= 80) msg = 'éå¸¸å„ªç§€ï¼ç¹¼çºŒä¿æŒï¼ğŸŒŸ';
        else if (percentage >= 60) msg = 'åšå¾—ä¸éŒ¯ï¼ŒåŠæ ¼äº†ï¼ğŸ‘';
        else msg = 'åŠ æ²¹ï¼Œå¤šæº«ç¿’ä¸€ä¸‹å†ä¾†æŒ‘æˆ°ï¼ğŸ’ª';
        
        document.getElementById('result-message').innerText = `${msg} (ç­”å° ${score} / ${currentQuiz.length} é¡Œ)`;
    }

    function resetApp() {
        hideAllScreens();
        menuScreen.style.display = 'block';
    }

    // ================= CHAT LOGIC (OFFLINE) =================
    
    let currentPersona = null;
    let isTyping = false;

    function showChatSelection() {
        hideAllScreens();
        chatSelectionScreen.style.display = 'block';
    }

    function startChat(personaKey) {
        currentPersona = chatData[personaKey];
        if(!currentPersona) return;

        hideAllScreens();
        chatScreen.style.display = 'flex'; // Flex for layout
        
        document.getElementById('chat-title').innerText = currentPersona.name;
        
        const chatContainer = document.getElementById('chat-container');
        chatContainer.innerHTML = ''; // Clear chat
        
        // Add Intro
        addChatBubble(currentPersona.intro, 'ai');

        // Render Question Buttons
        renderChatOptions();
    }

    function renderChatOptions() {
        const container = document.getElementById('chat-options-container');
        container.innerHTML = '';
        
        // Handle categorized options
        const cats = currentPersona.categories;
        if(cats) {
            for (const [categoryName, questions] of Object.entries(cats)) {
                // Add header
                const header = document.createElement('div');
                header.className = 'chat-category-title';
                header.innerText = categoryName;
                container.appendChild(header);

                // Add buttons
                questions.forEach(qObj => {
                    const btn = document.createElement('button');
                    btn.className = 'btn-choice';
                    btn.innerText = qObj.q;
                    btn.onclick = () => handleChatInteraction(qObj);
                    container.appendChild(btn);
                });
            }
        }
    }

    function handleChatInteraction(qObj) {
        if(isTyping) return; // Prevent double clicking while answering

        // User asks
        addChatBubble(qObj.q, 'user');
        
        // Show Typing Indicator
        showTypingIndicator();
        isTyping = true;
        
        // Simulate thinking delay based on text length
        const delay = 800 + Math.random() * 500;
        
        setTimeout(() => {
            removeTypingIndicator();
            addChatBubble(qObj.a, 'ai');
            isTyping = false;
        }, delay);
    }

    function showTypingIndicator() {
        const chatContainer = document.getElementById('chat-container');
        const indicator = document.createElement('div');
        indicator.className = 'typing-indicator';
        indicator.id = 'typing-indicator';
        indicator.innerHTML = `
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
        `;
        chatContainer.appendChild(indicator);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function removeTypingIndicator() {
        const indicator = document.getElementById('typing-indicator');
        if(indicator) indicator.remove();
    }

    function addChatBubble(text, type) {
        const chatContainer = document.getElementById('chat-container');
        const bubble = document.createElement('div');
        bubble.className = `chat-bubble ${type}`;
        bubble.innerText = text;
        chatContainer.appendChild(bubble);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function exitChat() {
        showChatSelection();
    }

</script>

</body>
</html>